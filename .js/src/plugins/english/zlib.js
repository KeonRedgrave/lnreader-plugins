var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function l(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((i=i.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var n,i,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=l(0),r.throw=l(1),r.return=l(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(o=0)),o;)try{if(n=1,i&&(a=2&l[0]?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,i=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){o.label=l[1];break}if(6===l[0]&&o.label<a[1]){o.label=a[1],a=l;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(l);break}a[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(e){l=[6,e],i=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("@libs/filterInputs"),i=require("cheerio"),a=require("@libs/defaultCover"),o=require("@libs/novelStatus"),r="",l=!1,c=function(){function c(){var e=this;this.id="zlib",this.name="Z-Library",this.icon="src/en/zlib/images.png",this.site="https://z-lib.fm",this.version="1.0.0",this.filters={yearFrom:{label:"Year From",value:"",type:n.FilterTypes.TextInput},yearTo:{label:"Year To",value:"",type:n.FilterTypes.TextInput},language:{label:"Language",options:[{label:"All",value:""},{label:"English",value:"english"},{label:"Japanese",value:"japanese"},{label:"Chinese",value:"chinese"},{label:"Korean",value:"korean"},{label:"French",value:"french"},{label:"German",value:"german"},{label:"Spanish",value:"spanish"},{label:"Bengali",value:"bengali"}],type:n.FilterTypes.Picker,value:""},extension:{label:"Extension",options:[{label:"All",value:""},{label:"epub",value:"EPUB"},{label:"pdf",value:"PDF"},{label:"mobi",value:"MOBI"},{label:"azw3",value:"AZW3"}],type:n.FilterTypes.Picker,value:""}},this.imageRequestInit=void 0,this.resolveUrl=function(t,n){return e.site+(n?"/book/":"")+t}}return c.prototype.filterUrl=function(n){return e(this,void 0,void 0,(function(){var e,i,a,o,l,c;return t(this,(function(t){return e="",i=new URLSearchParams,(null===(a=null==n?void 0:n.yearFrom)||void 0===a?void 0:a.value)&&i.append("yearFrom",n.yearFrom.value.toString()),(null===(o=null==n?void 0:n.yearTo)||void 0===o?void 0:o.value)&&i.append("yearTo",n.yearTo.value.toString()),(null===(l=null==n?void 0:n.language)||void 0===l?void 0:l.value)&&i.append("languages[]",n.language.value.toString()),(null===(c=null==n?void 0:n.extension)||void 0===c?void 0:c.value)&&i.append("extensions[]",n.extension.value.toString()),i.toString()&&(e="?"+i.toString(),r=e),[2,e]}))}))},c.prototype.popularNovels=function(n,a){return e(this,arguments,void 0,(function(e,n){var a,o,r,c,s,u=n.filters;return t(this,(function(e){switch(e.label){case 0:return a=[],o="",u&&Object.keys(u).length>0&&Object.values(u).some((function(e){return e.value}))?(r=this.site+"/s",[4,this.filterUrl(u)]):[3,2];case 1:return o=r+e.sent(),l=!0,[3,3];case 2:o=this.site+"/popular",e.label=3;case 3:return[4,this.getHtml(o)];case 4:return c=e.sent(),s=(0,i.load)(c),u&&Object.keys(u).length>0&&Object.values(u).some((function(e){return e.value}))?s("#searchResultBox").find("div.book-item").each((function(e,t){var n=s(t),i=n.find("div[slot=title]").text().trim(),o="".concat(n.find("z-bookcard").attr("href")),r=n.find("z-bookcard").find("img").attr("data-src"),l="".concat(i),c="".concat(o.replace(/^\/book\//,""));a.push({name:l,path:c,cover:r})})):s("div.masonry-endless").find("div.item").each((function(e,t){var n=s(t),i=n.find("z-cover").attr("title"),o="".concat(n.find("a").attr("href")),r=n.find("z-cover").find("img").attr("src"),l="".concat(i),c="".concat(o.replace(/^\/book\//,""));a.push({name:l,path:c,cover:r})})),[2,a]}}))}))},c.prototype.getHtml=function(n){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,fetch(n)];case 1:return[4,e.sent().text()];case 2:return[2,e.sent()]}}))}))},c.prototype.parseNovel=function(n){return e(this,void 0,void 0,(function(){var e,r,l,c,s,u,v,d,p,f,h,b,m,y,g,x;return t(this,(function(t){switch(t.label){case 0:return[4,this.getHtml("".concat(this.site,"/book/").concat(n))];case 1:return e=t.sent(),r=(0,i.load)(e),(l={path:n,name:r("div.col-sm-9").find("h1").text().trim()||"Untitled"}).name="".concat(r("div.col-sm-9").find("h1").text().trim()),l.author="".concat(r("z-cover").attr("author"))||"Unknown Author",l.cover="".concat(r("z-cover img").attr("src"))||a.defaultCover,l.genres="".concat(r("div.col-sm-9 div.bookDetailsBox div.property_value a").text().trim())||"Unknown Genre",l.status=o.NovelStatus.Completed,c=r("div.col-sm-9").find("#bookDescriptionBox"),s="",c.contents().each((function(e,t){if("text"===t.type)s+=r(t).text();else if("tag"===t.type&&"br"===t.tagName)s+="\n\n";else if("tag"===t.type&&"p"===t.name){var n=r(t).text().trim();n&&(s.endsWith("\n\n")||(s+="\n\n"),s+=n)}})),s=(s=s.trim()).replace(/\n{3,}/g,"\n\n"),u=s||"Description Unavailable",v=r("div.col-sm-9 div.bookDetailsBox div.property_content_type").find("span").text().trim()||"Unavailable",d=r("div.col-sm-9 div.bookDetailsBox div.property_year").find("div.property_value").text().trim()||"Unavailable",p=r("div.col-sm-9 div.bookDetailsBox div.property_publisher").find("div.property_value").text().trim()||"Unavailable",f=r("div.col-sm-9 div.bookDetailsBox div.property_language").find("div.property_value").text().toUpperCase().trim()||"Unavailable",h=r("div.col-sm-9 div.bookDetailsBox div.property_pages").find("div.property_value").text().trim()||"Unavailable",b=r("div.col-sm-9 div.bookDetailsBox div.property__file").find("div.property_value").text().trim()||"Unavailable",m=r("div.col-sm-9 div.bookDetailsBox div.property_series").find("div.property_value").text().trim()||"Unavailable",y=r("div.col-sm-9 div.bookDetailsBox div.property_volume").find("div.property_value").text().trim()||"Unavailable",l.summary="\n    Language: ".concat(f,"\n    Publisher: ").concat(p,"\n    Series: ").concat(m,"\n    Volume: ").concat(y,"\n    Year: ").concat(d,"\n    Content Type: ").concat(v,"\n    Pages: ").concat(h,"\n    File, Size: ").concat(b,"\n\n    ").concat(u,"\n      "),g=[],x={name:"".concat(r("div.col-sm-9").find("h1").text().trim()),path:"".concat(r("div.col-md-12 div section.book-actions-container div.book-details-button div.btn-group").eq(2).find("a.btn").attr("href")),releaseTime:r("div.col-sm-9 div.bookDetailsBox div.property_year").find("div.property_value").text().trim()||"Unavailable",chapterNumber:0},g.push(x),l.chapters=g,[2,l]}}))}))},c.prototype.parseChapter=function(n){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return n?(e="".concat(this.site).concat(n),[2,'\n          <p>\n            <b>Click below to download the EPUB:</b><br/>\n            <a href="'.concat(e,'">').concat(e,"</a>\n          </p>\n        ")]):[2,"No content."]}))}))},c.prototype.searchNovels=function(n,a){return e(this,void 0,void 0,(function(){var e,a,o,c;return t(this,(function(t){switch(t.label){case 0:return e=[],a=this.site+"/s"+(n.trim()?"/"+encodeURIComponent(n.trim()):""),l&&(a+=r),[4,this.getHtml(a)];case 1:return o=t.sent(),(c=(0,i.load)(o))("#searchResultBox").find("div.book-item").each((function(t,n){var i=c(n),a=i.find("div[slot=title]").text().trim(),o="".concat(i.find("z-bookcard").attr("href")),r=i.find("z-bookcard").find("img").attr("data-src"),l="".concat(a),s="".concat(o.replace(/^\/book\//,""));e.push({name:l,path:s,cover:r})})),[2,e]}}))}))},c}();exports.default=new c;